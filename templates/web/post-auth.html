{% extends 'web/base.html' %}
{% block title %}Compare{% endblock %}
{% block cta %}
<li class="nav-item">
    <button class="btn btn-light font-weight-bold "
            data-toggle="modal" data-target="#addRoomModal">Add Flatshare</button>
</li>
{% endblock %}
{% block content %}
{% load static %}
{% load filters %}

{% if error %}
<section class="pt-5 text-center">
    <div class="container">
        <div class="row">
            <div class="alert alert-danger col-12" role="alert">
              <h4 class="alert-heading">Could not compare spareroom ads</h4>
              <p>Unfortunately we could not compare one or both properties:</p>
              <ul>
                  {% for v in error.values %}
                  <li>{{v}}</li>
                  {% endfor %}
              </ul>
              <hr>
                <p>Please <a href="/" class="alert-link">retry</a> or contact support</p>
            </div>
        </div>
    </div>
</section>
{% else %}
{% if ads %}
<section class="pt-5 text-center">
    <div class="container rmc-container">
        <div class="row justify-content-around">
            <div class="d-flex rmc-h-scroller">
                {% for room_ad in ads %}
                <div class="{% if current_ads == 1 %}col-md-5{% else %}col-md{% endif %} {% if forloop.counter == 1 %}offset-md-2{% endif %} {% if current_ads > 3 %}col-5{% endif %}">
                    <div id="roomCarousel{{forloop.counter}}" class="carousel rmc-carousel">
                        <div class="carousel-inner">
                            {% for pic in room_ad|get_item:'photos'%}
                                {% if forloop.first %}
                                <div class="carousel-item active">
                                {% else %}
                                <div class="carousel-item">
                                {% endif %}
                                    <img class="img-fluid rounded rmc-carousel-img" src="{{ pic.large_url }}"
                                         alt="{{ pic.caption }}">
                                </div>
                            {% endfor %}
                        </div>
                        <a class="carousel-control-prev" href="#roomCarousel{{forloop.counter}}" role="button"
                           data-slide="prev">
                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                            <span class="sr-only">Previous</span>
                        </a>
                        <a class="carousel-control-next" href="#roomCarousel{{forloop.counter}}" role="button"
                           data-slide="next">
                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                            <span class="sr-only">Next</span>
                        </a>
                    </div>
                    <div class="h5 font-weight-bold my-2">{{ room_ad|get_item:'ad_title' }}</div>
                    <div class="container sticky-top rmc-secondary-navbar">
                        <a class="text-info" href="https://www.spareroom.co.uk/flatshare/flatshare_detail.pl?flatshare_id={{room_ad|get_item:'advert_id'}}"
                   target="_blank">{{room_ad|get_item:'property_type'}} share <br> {{room_ad|get_item:'neighbourhood_name'}} <br> {{room_ad|get_item:'postcode'|upper}}</a>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    <!--<div class="container sticky-top rmc-secondary-navbar">-->
        <!--<div class="row py-3">-->
            <!--<div class="col-md-2"></div>-->
            <!--{% for room_ad in ads %}-->
            <!--<div class="col">-->
                <!--<a class="text-info" href="https://www.spareroom.co.uk/flatshare/flatshare_detail.pl?flatshare_id={{room_ad|get_item:'advert_id'}}"-->
               <!--target="_blank">{{room_ad|get_item:'property_type'}} share <br> {{room_ad|get_item:'neighbourhood_name'}} - {{room_ad|get_item:'postcode'|upper}}</a>-->
            <!--</div>-->
            <!--{% endfor %}-->
        <!--</div>-->
    <!--</div>-->
    <!--<div class="container">-->
        <!--<div id="map" class="my-4 rmc-map"></div>-->
    <!--</div>-->
    <div class="container rmc-container">
        <div class="row mt-4">
            <div class="col-12 text-left border-bottom border-secondary pb-3">
                <span class="h5">Rooms</span>
            </div>
        </div>
        <section>
            {% for i in max_rooms %}
                <div class="row py-3 rmc-row">
                    <div class="col-12 col-md-2 mb-1 text-left"><span class="h6 mb-0 font-weight-bold">Room {{forloop.counter}}</span></div>
                    <div class="d-flex rmc-h-scroller">
                        {% for room_ad in ads %}
                        <div class="{% if current_ads == 1 %}col-md-5{% else %}col-md{% endif %} {% if forloop.counter == 1 %}offset-md-2{% endif %} {% if current_ads > 3 %}col-5{% endif %} rmc-item">
                            {% with room=room_ad.rooms|get_index:i %}
                            {% if room.room_price %}
                            <div class="font-weight-bold">
                                £{{ room|get_item:'room_price' }}
                                {{ room|get_item:'room_per'|lower }}
                            </div>
                            <div><span class="font-weight-bold">Deposit:</span> £{{ room|get_item:'security_deposit' }}</div>
                            <div><span class="font-weight-bold">Size:</span> {{ room|get_item:'room_type' }}</div>
                            <div><span class="font-weight-bold">Status:</span>
                                <span>
                                    {{ room|get_item:'room_status'|safe }}
                                </span></div>
                            {% else %}
                            <div>-</div>
                            {% endif %}
                            {% endwith %}
                        </div>
                        {% endfor %}
                    </div>
                </div>
            {% endfor%}
        </section>
        <div class="row mt-4">
            <div class="col-12 text-left border-bottom border-secondary pb-3">
                <span class="h5">Details</span>
            </div>
        </div>
        <section>
            {% for k,v in details.items %}
            <div class="row py-3 rmc-row">
                <div class="col-12 col-md-2 text-left mb-1"><span class="h6 mb-0 font-weight-bold">{{ v }}</span></div>
                <div class="d-flex rmc-h-scroller">
                    {% for room_ad in ads %}
                    <div class="{% if current_ads == 1 %}col-md-5{% else %}col-md{% endif %} {% if forloop.counter == 1 %}offset-md-2{% endif %} {% if current_ads > 3 %}col-5{% endif %} rmc-item">{{ room_ad|get_item:k|safe }}</div>
                    {% endfor%}
                </div>
            </div>
            {% endfor%}
        </section>
        <div class="row mt-4">
            <div class="col-12 text-left border-bottom border-secondary pb-3">
                <a class="rmc-toggle-icon text-body"
                   data-toggle="collapse"
                   href="#collapseAmenities"
                   role="button"
                   aria-expanded="false"
                   aria-controls="collapseAmenities"
                >
                    <h5>
                        Amenities
                        <i class="fas fa-caret-down float-right"></i>
                    </h5>
                </a>
            </div>
        </div>
        <section class="collapse" id="collapseAmenities">
            {% for k,v in amenities.items %}
            <div class="row py-3 rmc-row">
                <div class="col-12 col-md-2 text-left mb-1"><span class="h6 mb-0 font-weight-bold">{{ v }}</span></div>
                <div class="d-flex rmc-h-scroller">
                    {% for room_ad in ads %}
                    <div class="{% if current_ads == 1 %}col-md-5{% else %}col-md{% endif %} {% if forloop.counter == 1 %}offset-md-2{% endif %} {% if current_ads > 3 %}col-5{% endif %} rmc-item"><span class="h6 mb-0 d-block">{{ room_ad|get_item:k|safe }}</span></div>
                    {% endfor%}
                </div>
            </div>
            {% endfor%}
        </section>
            <div class="row mt-4">
                <div class="col-12 text-left border-bottom border-secondary pb-3">
                    <a class="rmc-toggle-icon text-body"
                       data-toggle="collapse"
                       href="#collapsePreferences"
                       role="button"
                       aria-expanded="false"
                       aria-controls="collapsePreferences"
                    >
                        <h5>
                            New Flatmate Preferences
                            <i class="fas fa-caret-down float-right"></i>
                        </h5>
                    </a>
                </div>
            </div>
            <section class="collapse" id="collapsePreferences">
            {% for k,v in preferences.items %}
                <div class="row py-3 rmc-row">
                    <div class="col-12 col-md-2 text-left mb-1"><span class="h6 mb-0 font-weight-bold">{{ v }}</span></div>
                    <div class="d-flex rmc-h-scroller">
                        {% for room_ad in ads %}
                        <div class="{% if current_ads == 1 %}col-md-5{% else %}col-md{% endif %} {% if forloop.counter == 1 %}offset-md-2{% endif %} {% if current_ads > 3 %}col-5{% endif %} rmc-item"><span class="h6 mb-0 d-block">{{ room_ad|get_item:k|safe }}</span></div>
                        {% endfor%}
                    </div>
                </div>
            {% endfor%}
            </section>
            <div class="row mt-4">
                <div class="col-12 text-left border-bottom border-secondary pb-3">
                    <a class="rmc-toggle-icon text-body"
                       data-toggle="collapse"
                       href="#collapseHousehold"
                       role="button"
                       aria-expanded="false"
                       aria-controls="collapseHousehold"
                    >
                        <h5>
                            Current Household
                            <i class="fas fa-caret-down float-right"></i>
                        </h5>
                    </a>
                </div>
            </div>
            <section class="collapse" id="collapseHousehold">
                {% for k,v in household.items %}
                <div class="row py-3 rmc-row">
                    <div class="col-12 col-md-2 text-left mb-1"><span class="h6 mb-0 font-weight-bold">{{ v }}</span></div>
                    <div class="d-flex rmc-h-scroller">
                        {% for room_ad in ads %}
                        <div class="{% if current_ads == 1 %}col-md-5{% else %}col-md{% endif %} {% if forloop.counter == 1 %}offset-md-2{% endif %} {% if current_ads > 3 %}col-5{% endif %} rmc-item"><span class="h6 mb-0 d-block">{{ room_ad|get_item:k|safe }}</span></div>
                        {% endfor%}
                    </div>
                </div>
                {% endfor%}
                <div class="row py-3 rmc-row">
                    <div class="col-12 col-md-2 text-left mb-1"><span class="h6 mb-0 font-weight-bold">Age</span></div>
                    <div class="d-flex rmc-h-scroller">
                        {% for room_ad in ads %}
                        <div class="{% if current_ads == 1 %}col-md-5{% else %}col-md{% endif %} {% if forloop.counter == 1 %}offset-md-2{% endif %} {% if current_ads > 3 %}col-5{% endif %} rmc-item"><span class="h6 mb-0 d-block">{{ room_ad|get_combined_item:'min_age+max_age' }}</span></div>
                        {% endfor%}
                    </div>
                </div>
                <div class="row py-3 rmc-row">
                    <div class="col-12 col-md-2 text-left mb-1"><span class="h6 m-0 font-weight-bold">Gender</span></div>
                    <div class="d-flex rmc-h-scroller">
                        {% for room_ad in ads %}
                        <div class="{% if current_ads == 1 %}col-md-5{% else %}col-md{% endif %} {% if forloop.counter == 1 %}offset-md-2{% endif %} {% if current_ads > 3 %}col-5{% endif %} rmc-item"><span class="h6 mb-0 d-block">{{ room_ad|get_combined_item:'number_of_males+number_of_females' }}</span></div>
                        {% endfor %}
                    </div>
                </div>
            </section>
            <div class="row mt-4">
                <div class="col-12 text-left border-bottom border-secondary pb-3">
                    <a class="rmc-toggle-icon text-body"
                       data-toggle="collapse"
                       href="#collapseDescription"
                       role="button"
                       aria-expanded="false"
                       aria-controls="collapseDescription"
                    >
                        <h5>
                            Description
                            <i class="fas fa-caret-down float-right"></i>
                        </h5>
                    </a>
                </div>
            </div>
            <section class="collapse" id="collapseDescription">
                <div class="row py-3">
                    <div class="col-12 col-md-2 mb-1"></div>
                    <div class="d-flex rmc-h-scroller">
                        {% for room_ad in ads %}
                        <div class="{% if current_ads == 1 %}col-md-5{% else %}col-md{% endif %} {% if forloop.counter == 1 %}offset-md-2{% endif %} {% if current_ads > 3 %}col-5{% endif %} text-left">
                            <span class="h6 mb-0 d-block">{{ room_ad|get_item:'ad_text'|linebreaks }}</span>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </section>
        <div class="text-right my-4">
            <small class="text-muted form-text">Anything you'd like to see here? <a href="/feedback" class="text-info"> Let us know!</a>
            </small>
        </div>
    </div>
</section>
{% else %}
<section class="pt-5 text-center">
    <h1 class="h2 mx-xl-6 font-weight-bold">Your watchlist is empty.</h1>
    <p class="lead">Looks like no one is here yet. Awkwarrrd. <br> Click the "Add flatshare" button to begin with ...</p>
    <div class="my-5">
        <img class="img-fluid rmc-about"
             src="{% static 'web/img/illustrations/empty.png' %}"
             alt="Empty illustration">
    </div>
</section>
{% endif %}
{% endif %}


<div class="modal fade" id="addRoomModal" tabindex="-1" role="dialog" aria-labelledby="addRoomModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-body">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <div class="m-xl-4 m-3">
                    <div class="text-center mb-4">
                        <h4 class="h3 mb-1 font-weight-bold">Add Flatshare</h4>
                    </div>
                    <form method="POST">
                    {% csrf_token %}
                        <p class="mb-1 text-center">Add up to 5 properties to compare side by side. {% if remaining_ads <= 3 %} {{remaining_ads}} to go! {% endif %}</p>
                            <div class="form-group mb-3">
                                <input
                                    type="text"
                                    class="form-control form-control-lg form-control input"
                                    name="{{ form.room_ad.name }}"
                                    id="{{ form.room_ad.id }}"
                                    placeholder="{{ form.room_ad.initial }}"
                                    required
                                />
                                {% for error in form.room_ad.errors %}
                                    <div class="text-danger">{{ error }}</div>
                                {% endfor %}
                            </div>
                            <div class="modal-footer border-0 p-0">
                            <!--<button type="button" class="btn btn-success font-weight-bold">Add</button>-->
                            <button type="submit" class="btn btn-dark btn-block rmc-cta font-weight-bold">Compare Now</button>
                        </div>
                    </form>
            <!--                        <small class="text-muted form-text">We’ll never share your details. See our <a href="#">Privacy Policy</a>-->
            <!--                        </small>-->
              </div>
            </div>
        </div>
  </div>
</div>

{% endblock %}
{% block js%}
    {% load static %}
    {{ block.super }} {# includes previous content in block #}
    <script type="text/javascript" src="{% static 'web/js/compare.js' %}"></script>
{% endblock%}